---
title: "Behavioral Health Population-based Measures"
subtitle: ""

format:
  html:
    theme:
      - cosmo
      - brand
    css: styles.css
    toc: false
    
execute: 
  echo: false
  eval: false
  warning: false
  message: false
  error: false
  cache: true
---

```{r}
#| label: setup
#| eval: true
#| include: false

# -----------------------------------------------------------------------------
# 1. Setup/Dependencies (Package Manager)
# -----------------------------------------------------------------------------

library(pacman)

# -----------------------------------------------------------------------------
# 2. Package Loading (Streamlined and Reorganized)
# -----------------------------------------------------------------------------

# Core/Essential Packages (General R use)
p_load(
  here,          # Folder/file management
  conflicted,    # Package conflict management
  english,       # Translate integers into text
  labelled,      # Manipulate variable/value metadata
  rlang,         # Functions for base R and tidyverse features
  xfun,          # Miscellaneous functions
  rio,           # Universal import/export
  archive,       # Archive files
  filesstrings,  # String manipulation
  googledrive,   # Interact with Google Drive
  rsconnect,     # RStudio Connect
  reprex,        # Reproducible examples
  knitr          # Dynamic report generation
)

# Data Manipulation and Transformation (Tidyverse first, then others)
p_load(
  tidyverse,      # Tidy data handling and analysis (includes dplyr, tidyr, ggplot2, etc.)
  tidycensus,    # Census data access
  janitor,       # Data cleaning and examination
  bestNormalize, # Data normalization
  mice,          # Multivariate imputation
  skimr          # Summary statistics
)

# Tables
p_load(
  gt,            # Presentation-ready tables
  gtsummary,     # Publication-ready tables
  gtExtras,      # Additional gt functions
  flextable      # MS Office compatible tables
)

# Visualization (ggplot2 related first)
p_load(
  scales,        # Graphical scales (often used with ggplot2)
  systemfonts,   # System fonts
  extrafont,     # Font management
  showtext,      # Easy font use in plots
  patchwork,     # Plot composition
  plotly,        # Interactive plots
  ggpp,          # ggplot2 extensions
  ggExtra,       # ggplot2 enhancements
  ggalt,         # Extra ggplot2 geoms/stats
  ggpubr,        # Easy plot creation
  ggridges,      # Ridgeline plots
  ggfittext,     # Improved text rendering
  ggtext,         # Improved text rendering
  ggthemes,       # ggplot2 themes
  ggsci,          # ggplot2 color palettes
  scico,          # Scientific color maps
  hrbrthemes,     # ggplot2 themes
  viridis         # ggplot2 color palettes
)

# Visualization (GitHub)
p_load_gh(
  "AliciaSchep/gglabeller",       # Easy plot labeling
  "MarcellGranat/ggProfessional", # Professional ggplot2
  "mattcowgill/ggannotate",       # Easy plot annotation
  "amirmasoudabdol/sfthemes"     # Simple features themes
)

# Visualization (Other)
p_load(
  # extrafont,  # Font tools (Consider if needed with showtext)
  magick,        # Image processing (Consider if actively used)
  xkcd,          # xkcd theme (Consider if actively used)
  harrypotter    # Harry Potter theme (Consider if actively used)
)

# Compatibility & Other
p_load(
  officedown,    # Microsoft Office compatibility
  DBI,           # Database interaction
  units,         # Measurement units
  yardstick,     # Model metrics
  surveillance   # Epidemic modeling
)

# -----------------------------------------------------------------------------
# 3. Conflict Resolution (After loading)
# -----------------------------------------------------------------------------

conflicts_prefer(
  dplyr::filter, 
  dplyr::first,
  dplyr::summarize, 
  dplyr::select, 
  janitor::clean_names,
  lubridate::year, 
  rio::export,
  tidyselect::starts_with,
  tidygeocoder::geocode
)

# -----------------------------------------------------------------------------
# 4. Global Parameters/Constants
# -----------------------------------------------------------------------------

# Global Settings
set.seed(13) # Random seed for reproducibility
options(scipen = 9999) # Large number for scientific notation preference

# -----------------------------------------------------------------------------
# 5. Themes and Table Defaults
# -----------------------------------------------------------------------------

# gtsummary Themes
gtsummary::theme_gtsummary_journal(journal = "jama")
gtsummary::theme_gtsummary_compact()

# flextable Defaults (Font check!)
flextable::set_flextable_defaults(
  table.layout = "autofit", 
  font.size = 10, 
  font.family = "Times New Roman", # Ensure this font is available!
  padding.top = 0, 
  padding.bottom = 0
)

# custom color palette
mchd_county_logo_blue = "#326195"
mchd_county_logo_green = "#48773C"
mchd_green = "#385D2F"
mchd_claret = "#8C183E"
mchd_deep_saffron = "#F79232"
mchd_copper_rose = "#9b6167"
mchd_light_cerulean = "#72CCD4"

perma_list <- c("data_repo", "gis_repo", "mchd_claret", "mchd_copper_rose", "mchd_county_logo_blue", "mchd_county_logo_green", "mchd_deep_saffron", "mchd_green", "mchd_light_cerulean")

# -----------------------------------------------------------------------------
# 6. Font Loading
# -----------------------------------------------------------------------------

# Enable showtext for custom fonts
showtext::showtext_auto() 

# -----------------------------------------------------------------------------
# 8.  Session Information
# -----------------------------------------------------------------------------

sessionInfo()
```

## Overview

Welcome to the behavioral health outcomes dashboard. This dashboard provides a summary of key metrics and trends across different areas of behavioral health. Please use the menu on the left to navigate between different measures.






